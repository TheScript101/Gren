local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- UI Setup
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
screenGui.Name = "TASGui"
screenGui.ResetOnSpawn = false

local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Size = UDim2.new(0, 300, 0, 420)
mainFrame.Position = UDim2.new(0.5, -150, 0.5, -210)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true

local uiCorner = Instance.new("UICorner", mainFrame)
uiCorner.CornerRadius = UDim.new(0, 8)



-- Toggle Button
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 100, 0, 30)
toggleButton.Position = UDim2.new(0, 10, 0, 10)
toggleButton.Text = "Toggle GUI"
toggleButton.Parent = screenGui
toggleButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
toggleButton.TextColor3 = Color3.new(1, 1, 1)
toggleButton.Font = Enum.Font.SourceSans
toggleButton.TextSize = 18

-- Toggle function
local guiVisible = true
toggleButton.MouseButton1Click:Connect(function()
	guiVisible = not guiVisible
	mainFrame.Visible = guiVisible
end)




-- Fling Speed TextBox
local speedBox = Instance.new("TextBox", mainFrame)
speedBox.Size = UDim2.new(1, -20, 0, 30)
speedBox.Position = UDim2.new(0, 10, 0, 10)
speedBox.PlaceholderText = "Fling Speed (Default: 80)"
speedBox.Text = ""
speedBox.TextColor3 = Color3.new(1, 1, 1)
speedBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
speedBox.Font = Enum.Font.Gotham
speedBox.TextSize = 16
speedBox.ClearTextOnFocus = false

local speedCorner = Instance.new("UICorner", speedBox)
speedCorner.CornerRadius = UDim.new(0, 6)



local RotationForceLabel = Instance.new("TextLabel")
RotationForceLabel.Size = UDim2.new(1, 0, 0, 20)
RotationForceLabel.BackgroundTransparency = 1
RotationForceLabel.Text = "Rotation Force Multiplier"
RotationForceLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
RotationForceLabel.Parent = ScrollFrame

local RotationForceBox = Instance.new("TextBox")
RotationForceBox.Size = UDim2.new(1, 0, 0, 30)
RotationForceBox.PlaceholderText = "Default: 1"
RotationForceBox.Text = ""
RotationForceBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
RotationForceBox.TextColor3 = Color3.fromRGB(255, 255, 255)
RotationForceBox.ClearTextOnFocus = false
RotationForceBox.Parent = ScrollFrame
local function getRotationForceMultiplier()
    return tonumber(RotationForceBox.Text) or 1
end





-- Scroll Frame
local scrollFrame = Instance.new("ScrollingFrame", mainFrame)
scrollFrame.Size = UDim2.new(1, -20, 1, -130)
scrollFrame.Position = UDim2.new(0, 10, 0, 50)
scrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
scrollFrame.ScrollBarThickness = 6
scrollFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
scrollFrame.BorderSizePixel = 0

local layout = Instance.new("UIListLayout", scrollFrame)
layout.Padding = UDim.new(0, 6)
layout.SortOrder = Enum.SortOrder.LayoutOrder

-- Add Button
local addButton = Instance.new("TextButton", mainFrame)
addButton.Size = UDim2.new(0.5, -15, 0, 40)
addButton.Position = UDim2.new(0, 10, 1, -45)
addButton.Text = "+ Add"
addButton.TextSize = 20
addButton.Font = Enum.Font.GothamBold
addButton.TextColor3 = Color3.new(1, 1, 1)
addButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)

local addCorner = Instance.new("UICorner", addButton)
addCorner.CornerRadius = UDim.new(0, 6)

-- Send Button
local sendButton = Instance.new("TextButton", mainFrame)
sendButton.Size = UDim2.new(0.5, -15, 0, 40)
sendButton.Position = UDim2.new(0.5, 5, 1, -45)
sendButton.Text = "Send"
sendButton.TextSize = 20
sendButton.Font = Enum.Font.GothamBold
sendButton.TextColor3 = Color3.new(1, 1, 1)
sendButton.BackgroundColor3 = Color3.fromRGB(0, 140, 255)

local sendCorner = Instance.new("UICorner", sendButton)
sendCorner.CornerRadius = UDim.new(0, 6)

-- Add TextBox Function
local function addPositionBox()
	local box = Instance.new("TextBox")
	box.Parent = scrollFrame
	box.Size = UDim2.new(1, -10, 0, 30)
	box.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
	box.PlaceholderText = "Enter X, Y, Z"
	box.Text = ""
	box.TextColor3 = Color3.new(1, 1, 1)
	box.ClearTextOnFocus = false
	box.Font = Enum.Font.Gotham
	box.TextSize = 16

	local corner = Instance.new("UICorner", box)
	corner.CornerRadius = UDim.new(0, 6)

	scrollFrame.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 10)
end

-- TAS Fling Function with Rotation
local function flingTo(position, speed)
	if not flingEnabled then return end  -- ⬅️ Make sure fling toggle is respected

	local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
	if not hrp then return end

	local direction = (position - hrp.Position)
	local bv = Instance.new("BodyVelocity")
	bv.Velocity = direction.Unit * speed + Vector3.new(0, 50, 0)
	bv.MaxForce = Vector3.new(1, 1, 1) * math.huge
	bv.P = 10000
	bv.Parent = hrp

	local rotForceMultiplier = tonumber(RotationForceBox.Text) or 1

	local bav = Instance.new("BodyAngularVelocity")
	bav.AngularVelocity = Vector3.new(
		0,
		math.rad(500 * rotForceMultiplier),
		0
	)
	bav.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
	bav.P = 10000
	bav.Parent = hrp

	game.Debris:AddItem(bv, 0.5)
	game.Debris:AddItem(bav, 0.5)
end


-- Send Button Logic
sendButton.MouseButton1Click:Connect(function()
	local flingSpeed = tonumber(speedBox.Text) or 80
	for _, box in ipairs(scrollFrame:GetChildren()) do
		if box:IsA("TextBox") and box.Text ~= "" then
			local x, y, z = string.match(box.Text, "([^,]+),%s*([^,]+),%s*([^,]+)")
			if x and y and z then
				local vec = Vector3.new(tonumber(x), tonumber(y), tonumber(z))
				flingTo(vec, flingSpeed)
				task.wait(0.7)
			end
		end
	end
end)

-- Add Button Logic
addButton.MouseButton1Click:Connect(addPositionBox)

-- Initialize First Entry
addPositionBox()

-- Settings Button
local settingsButton = Instance.new("TextButton")
settingsButton.Size = UDim2.new(0, 100, 0, 30)
settingsButton.Position = UDim2.new(0.5, -50, 1, -90)
settingsButton.Text = "Settings"
settingsButton.Font = Enum.Font.Gotham
settingsButton.TextSize = 16
settingsButton.TextColor3 = Color3.new(1, 1, 1)
settingsButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
settingsButton.Parent = mainFrame

-- Settings Panel
local settingsPanel = Instance.new("Frame")
settingsPanel.Size = UDim2.new(0, 200, 0, 150)
settingsPanel.Position = UDim2.new(1, 10, 0, 0)
settingsPanel.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
settingsPanel.Visible = false
settingsPanel.Parent = mainFrame

local corner = Instance.new("UICorner", settingsPanel)
corner.CornerRadius = UDim.new(0, 6)

settingsButton.MouseButton1Click:Connect(function()
	settingsPanel.Visible = not settingsPanel.Visible
end)

-- Save Config Box
local saveBox = Instance.new("TextBox", settingsPanel)
saveBox.Size = UDim2.new(1, -20, 0, 30)
saveBox.Position = UDim2.new(0, 10, 0, 10)
saveBox.PlaceholderText = "Save Config Name"
saveBox.Text = ""
saveBox.TextColor3 = Color3.new(1, 1, 1)
saveBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
saveBox.ClearTextOnFocus = false

local saveButton = Instance.new("TextButton", settingsPanel)
saveButton.Size = UDim2.new(1, -20, 0, 30)
saveButton.Position = UDim2.new(0, 10, 0, 50)
saveButton.Text = "Save Config"
saveButton.TextColor3 = Color3.new(1, 1, 1)
saveButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)

-- Load Config Box
local loadBox = Instance.new("TextBox", settingsPanel)
loadBox.Size = UDim2.new(1, -20, 0, 30)
loadBox.Position = UDim2.new(0, 10, 0, 90)
loadBox.PlaceholderText = "Load Config Name"
loadBox.TextColor3 = Color3.new(1, 1, 1)
loadBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
loadBox.ClearTextOnFocus = false

local loadButton = Instance.new("TextButton", settingsPanel)
loadButton.Size = UDim2.new(1, -20, 0, 30)
loadButton.Position = UDim2.new(0, 10, 0, 130)
loadButton.Text = "Load Config"
loadButton.TextColor3 = Color3.new(1, 1, 1)
loadButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)

-- Config Save/Load Logic
local HttpService = game:GetService("HttpService")
local configFolder = "TAS_Configs"
if not isfolder(configFolder) then
	makefolder(configFolder)
end

saveButton.MouseButton1Click:Connect(function()
	local name = saveBox.Text
	if name == "" then return end
	local data = {
		speed = speedBox.Text,
		positions = {},
	}
	for _, box in ipairs(scrollFrame:GetChildren()) do
		if box:IsA("TextBox") then
			table.insert(data.positions, box.Text)
		end
	end
	writefile(configFolder.."/"..name..".json", HttpService:JSONEncode(data))
end)

loadButton.MouseButton1Click:Connect(function()
	local name = loadBox.Text
	if name == "" then return end
	local path = configFolder.."/"..name..".json"
	if not isfile(path) then
		game.StarterGui:SetCore("SendNotification", {
			Title = "Config Error",
			Text = "Config not found!",
			Duration = 3
		})
		return
	end

	local data = HttpService:JSONDecode(readfile(path))
	speedBox.Text = data.speed or ""

	-- Clear old boxes
	for _, child in ipairs(scrollFrame:GetChildren()) do
		if child:IsA("TextBox") then
			child:Destroy()
		end
	end

	-- Load positions
	for _, pos in ipairs(data.positions) do
		addPositionBox()
		scrollFrame:GetChildren()[#scrollFrame:GetChildren()].Text = pos
	end
end)

