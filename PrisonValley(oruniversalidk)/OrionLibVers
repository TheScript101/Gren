-- -------------------------
-- Orion UI (4 toggles: Inmate/Officer Inventory & Chams)
-- -------------------------
local success, OrionLib = pcall(function()
    return loadstring(game:HttpGet("https://raw.githubusercontent.com/jensonhirst/Orion/main/source"))()
end)

-- helper apply functions
local function applyInmateInventory(state)
    inmateInventoryEnabled = state
    if not state then
        for _, p in ipairs(Players:GetPlayers()) do
            if isInmate(p) then removeBillboardForPlayer(p) end
        end
    else
        for _, p in ipairs(Players:GetPlayers()) do
            if isInmate(p) and p.Character then
                createBillboardForPlayer(p, p.Character)
                refreshItemsForPlayer(p)
            end
        end
    end
end

local function applyInmateChams(state)
    inmateChamsEnabled = state
    if not state then
        for _, p in ipairs(Players:GetPlayers()) do
            if isInmate(p) then removeChamsForPlayer(p) end
        end
    else
        for _, p in ipairs(Players:GetPlayers()) do
            if isInmate(p) and p.Character then
                makeChamsForChar(p, p.Character)
                updateChamsColorForPlayer(p, getTeamColor(p))
            end
        end
    end
end

local function applyOfficerInventory(state)
    officerInventoryEnabled = state
    if not state then
        for _, p in ipairs(Players:GetPlayers()) do
            if not isInmate(p) and p ~= LocalPlayer then removeBillboardForPlayer(p) end
        end
    else
        for _, p in ipairs(Players:GetPlayers()) do
            if not isInmate(p) and p.Character and p ~= LocalPlayer then
                createBillboardForPlayer(p, p.Character)
                refreshItemsForPlayer(p)
            end
        end
    end
end

local function applyOfficerChams(state)
    officerChamsEnabled = state
    if not state then
        for _, p in ipairs(Players:GetPlayers()) do
            if not isInmate(p) and p ~= LocalPlayer then removeChamsForPlayer(p) end
        end
    else
        for _, p in ipairs(Players:GetPlayers()) do
            if not isInmate(p) and p.Character and p ~= LocalPlayer then
                makeChamsForChar(p, p.Character)
                updateChamsColorForPlayer(p, getTeamColor(p))
            end
        end
    end
end

if success and OrionLib then
    local Window = OrionLib:MakeWindow({
        Name = "Valley Prison Roleplay",
        HidePremium = false,
        SaveConfig = false
    })

    local Tab = Window:MakeTab({
        Name = "ESP",
        Icon = "rbxassetid://4483345998",
        PremiumOnly = false
    })

    -- Inmate toggles
    Tab:AddToggle({
        Name = "Inmate Inventory ESP",
        Default = inmateInventoryEnabled,
        Callback = function(val) applyInmateInventory(val) end
    })
    Tab:AddToggle({
        Name = "Inmate Chams",
        Default = inmateChamsEnabled,
        Callback = function(val) applyInmateChams(val) end
    })

    -- Officer toggles
    Tab:AddToggle({
        Name = "Officer Inventory ESP",
        Default = officerInventoryEnabled,
        Callback = function(val) applyOfficerInventory(val) end
    })
    Tab:AddToggle({
        Name = "Officer Chams",
        Default = officerChamsEnabled,
        Callback = function(val) applyOfficerChams(val) end
    })

    OrionLib:Init()
else
    warn("Orion failed to load. Toggles will remain variables â€” set them manually in the script if needed.")
end
