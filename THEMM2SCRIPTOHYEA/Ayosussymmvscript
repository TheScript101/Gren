-- Robust Chat Button with rblxthumb image + client "WORKED" chat message
-- Paste into an executor LocalScript

local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local ContentProvider = game:GetService("ContentProvider")
local StarterGui = game:GetService("StarterGui")
local TextChatService = game:GetService("TextChatService")

local IMAGE_ID = 126174819916927
local THUMB = "rblxthumb://type=Asset&id=" .. IMAGE_ID .. "&w=420&h=420"

-- Helper: send chat commands (TextChatService if available)
local function sendChatMessage(msg)
    local success, err = pcall(function()
        if TextChatService and TextChatService.TextChannels then
            local ch = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
            if ch and ch.SendAsync then
                ch:SendAsync(msg)
                return true
            end
        end
    end)
    if not success then
        warn("sendChatMessage pcall failed:", err)
    end
    -- no fallback for player-sent chat (we're using the game's chat API); some games block it
end

-- Helper: show client-side "WORKED" message in chat
local function showClientMessage(text)
    -- Try modern TextChatService DisplaySystemMessage (client-side)
    local ok, result = pcall(function()
        if TextChatService and TextChatService.TextChannels then
            local ch = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
            if ch and ch.DisplaySystemMessage then
                ch:DisplaySystemMessage(text)
                return true
            end
        end
        return false
    end)
    if ok and result then return end

    -- Fallback to classic system message
    pcall(function()
        StarterGui:SetCore("ChatMakeSystemMessage", {
            Text = text;
            Color = Color3.fromRGB(0, 255, 0);
            Font = Enum.Font.SourceSansBold;
            FontSize = Enum.FontSize.Size24;
        })
    end)
end

-- Create CoreGui ScreenGui (executor-safe)
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ChatButtonGui"
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global
screenGui.Parent = CoreGui

print("ChatButtonGui parented to CoreGui")

-- Create main TextButton (visible fallback + clickable)
local btn = Instance.new("TextButton")
btn.Name = "ChatButton"
btn.Size = UDim2.new(0, 90, 0, 90) -- pixel size for reliability
btn.Position = UDim2.new(1, -120, 1, -180) -- bottom-right-ish
btn.AnchorPoint = Vector2.new(0, 0)
btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
btn.BorderSizePixel = 0
btn.Text = "" -- we'll overlay image; text used as fallback
btn.TextColor3 = Color3.fromRGB(255,255,255)
btn.Font = Enum.Font.GothamBold
btn.TextSize = 14
btn.AutoButtonColor = true
btn.Active = true
btn.Draggable = true
btn.Parent = screenGui
btn.ZIndex = 1000

-- Add an ImageLabel on top of the button using rblxthumb (attempt)
local img = Instance.new("ImageLabel")
img.Name = "Icon"
img.Size = UDim2.new(1, 0, 1, 0)
img.Position = UDim2.new(0, 0, 0, 0)
img.BackgroundTransparency = 1
img.BorderSizePixel = 0
img.ScaleType = Enum.ScaleType.Fit
img.Image = THUMB
img.Parent = btn
img.ZIndex = btn.ZIndex + 1

-- Also add a small text overlay used as fallback and click feedback
local overlay = Instance.new("TextLabel")
overlay.Name = "OverlayText"
overlay.Size = UDim2.new(1, 0, 1, 0)
overlay.BackgroundTransparency = 1
overlay.Text = "SEND"
overlay.Font = Enum.Font.GothamBold
overlay.TextSize = 18
overlay.TextColor3 = Color3.fromRGB(255,255,255)
overlay.Parent = btn
overlay.ZIndex = btn.ZIndex + 2
overlay.TextWrapped = true

-- Try preloading the image to improve chances it renders
pcall(function()
    ContentProvider:PreloadAsync({ THUMB })
end)

-- If image fails to display after a short delay, fall back to using the rbxassetid url
task.delay(0.75, function()
    -- If image didn't load (ImageLabel still has default placeholder), try rbxassetid fallback
    if not img.Image or img.Image == "" then
        pcall(function() img.Image = "rbxassetid://" .. IMAGE_ID end)
    end
end)

-- Click handler: sends chat commands and shows client message
local clicked = false
btn.MouseButton1Click:Connect(function()
    if clicked then return end
    clicked = true

    -- Visual feedback
    overlay.Text = "SENT"
    overlay.TextColor3 = Color3.fromRGB(200,200,200)

    -- Fire the chat commands
    pcall(function()
        sendChatMessage("/sheriff Gokugamercoolki")
        sendChatMessage("/map beachresort")
        sendChatMessage("/murderer 360iytt")
    end)

    -- Show client-side confirmation in chat
    showClientMessage("âœ… WORKED")

    -- revert overlay after short delay
    task.delay(0.9, function()
        overlay.Text = "SEND"
        overlay.TextColor3 = Color3.fromRGB(255,255,255)
        clicked = false
    end)
end)

print("Chat button created. Click it to send messages.")
